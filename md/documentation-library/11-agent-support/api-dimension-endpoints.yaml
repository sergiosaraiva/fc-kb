# API Dimension Endpoints
# Financial Consolidation Agent API Documentation
# Version: 1.0
# Purpose: Machine-parseable endpoint definitions for AI agent management of dimensions and dimension groups

api_dimension_endpoints:
  name: "Dimension and Dimension Group API Endpoints"
  version: "1.0"
  description: |
    API endpoints for managing dimensions and dimension groups in the consolidation system.

    Dimensions enable segment analysis and multi-dimensional reporting:
    - Custom analytical dimensions (e.g., Product, Region, Department)
    - Hierarchical dimension trees with parent-child relationships
    - Dimension groups combining up to 3 dimensions
    - Dimension data entry for allocating amounts across segments
    - Company-dimension group assignments for reporting

    Key concepts:
    - Dimension: A single analytical axis (e.g., Product Line, Region)
    - Dimension Detail: A node in the dimension hierarchy (e.g., "Electronics" under "Products")
    - Dimension Group: Combines 1-3 dimensions for multi-dimensional analysis
    - Dimension Company Group: Links companies to specific dimension details
    - Dimension Data Entry: Matrix view for entering dimension-level amounts

    Services documented:
    - DimensionService: Dimension master data (5 handlers)
    - DimensionGroupService: Dimension groupings (4 handlers)
    - DimensionTreeService: Hierarchical dimension structure (5 handlers)
    - DimensionDataEntryService: Dimension data entry (4 handlers)
    - DimensionCompanyGroupService: Company-dimension linking (8 handlers)

  # ============================================================================
  # ENUMS
  # ============================================================================
  enums:
    DisplayModes:
      description: "Context for dimension data entry"
      values:
        - value: 0
          name: "Undefined"
          description: "Default/invalid"
        - value: 1
          name: "Local"
          description: "Local bundle dimension amounts"
        - value: 2
          name: "LocalInterco"
          description: "Intercompany dimension amounts"
        - value: 3
          name: "GroupAdjustments"
          description: "Group adjustment dimension amounts"

    SelectedAvailable:
      description: "Selection state for company assignments"
      values:
        - char: "A"
          name: "Available"
          description: "Company is available to be added"
        - char: "S"
          name: "Selected"
          description: "Company is already selected/assigned"

    DimensionDetailTypes:
      description: "Types of dimension detail nodes"
      values:
        - char: "N"
          name: "Normal"
          description: "Regular dimension detail node"
        - char: "U"
          name: "Unexplained"
          description: "Artificial node for unexplained amounts"
        - char: "T"
          name: "Technical"
          description: "Artificial node for technical amounts"

  # ============================================================================
  # DATA TRANSFER OBJECTS
  # ============================================================================
  dto_definitions:
    DimensionDTO:
      description: "Dimension master data"
      source: "DimensionService.cs"
      fields:
        - name: "DimensionID"
          type: "integer"
          description: "Unique dimension identifier"
        - name: "DimensionCode"
          type: "string"
          description: "Dimension code"
        - name: "DimensionDescription"
          type: "string"
          description: "Dimension display name (localized)"
        - name: "EntityVersion"
          type: "array<EntityVersion>"
          nullable: true

    DimensionGroupDTO:
      description: "Dimension group combining up to 3 dimensions"
      source: "DimensionGroupService.cs"
      fields:
        - name: "DimensionGroupID"
          type: "integer"
          nullable: true
          description: "Unique group identifier"
        - name: "DimensionGroupCode"
          type: "string"
          description: "Group code (max 25 chars)"
        - name: "DimensionGroupName"
          type: "string"
          description: "Group display name"
        - name: "Active"
          type: "boolean"
          description: "Whether group is active"
        - name: "Dimension1ID"
          type: "integer"
          nullable: true
          description: "First dimension ID (required)"
        - name: "Dimension2ID"
          type: "integer"
          nullable: true
          description: "Second dimension ID (optional)"
        - name: "Dimension3ID"
          type: "integer"
          nullable: true
          description: "Third dimension ID (optional)"
        - name: "SelectedAccounts"
          type: "array<DimensionGroupAccountDTO>"
          nullable: true
          description: "Accounts assigned to this group"
        - name: "AvailableAccounts"
          type: "array<DimensionGroupAccountDTO>"
          nullable: true
          description: "Accounts available to assign"
        - name: "EntityVersion"
          type: "array<EntityVersion>"
          nullable: true

    DimensionGroupAccountDTO:
      description: "Account assignment to dimension group"
      fields:
        - name: "AccountID"
          type: "integer"
          nullable: true
        - name: "AccountType"
          type: "string"
          description: "B=Balance, P=P&L"
        - name: "DebitCredit"
          type: "string"
          description: "D=Debit, C=Credit"
        - name: "AccountCode"
          type: "string"
        - name: "AccountDescription"
          type: "string"
        - name: "SelectedAvailable"
          type: "string"
          description: "S=Selected, A=Available"

    DimTreeNode:
      description: "Dimension tree node for hierarchical display"
      source: "DimensionTreeService.cs"
      fields:
        - name: "ID"
          type: "integer"
          nullable: true
          description: "DimensionID"
        - name: "EntityID"
          type: "integer"
          nullable: true
          description: "DimensionDetailID"
        - name: "Code"
          type: "string"
          description: "Detail code"
        - name: "Description"
          type: "string"
          description: "Detail description (localized)"
        - name: "HasChildren"
          type: "boolean"
          description: "Whether node has children"
        - name: "IsExpanded"
          type: "boolean"
          description: "Expansion state"
        - name: "DepthLevel"
          type: "integer"
          description: "Nesting depth (0=root)"
        - name: "FieldTypeSingle"
          type: "boolean"
          description: "Leaf node flag"
        - name: "FieldTypeAll"
          type: "boolean"
          description: "Has children flag"

    DimensionDataEntryResult:
      description: "Dimension data entry matrix data"
      source: "DimensionDataEntryService.cs"
      fields:
        - name: "CompanyLocked"
          type: "boolean"
          description: "Whether company is locked for editing"
        - name: "DimensionGroups"
          type: "array"
          description: "Available dimension groups"
        - name: "DimensionGroupID"
          type: "integer"
          nullable: true
        - name: "DataItems"
          type: "array"
          description: "Matrix values (X, Y, Z, Value)"
        - name: "XLabels"
          type: "array"
          description: "Dimension 2 labels"
        - name: "YLabels"
          type: "array"
          description: "Dimension 1 labels"
        - name: "ZLabels"
          type: "array"
          description: "Dimension 3 labels"
        - name: "XAxisName"
          type: "string"
          nullable: true
        - name: "YAxisName"
          type: "string"
          nullable: true
        - name: "ZAxisName"
          type: "string"
          nullable: true
        - name: "LocalAmount"
          type: "decimal"
          nullable: true
          description: "Total local amount"
        - name: "AdjustedAmount"
          type: "decimal"
          nullable: true
          description: "Total adjusted amount"
        - name: "NbrDec"
          type: "byte"
          nullable: true
          description: "Number of decimal places"
        - name: "UnitsOf"
          type: "byte"
          nullable: true
          description: "Unit scale (0=units, 1=thousands)"
        - name: "IncludeSign"
          type: "short"
          nullable: true
          description: "Sign convention"
        - name: "ClientSideCalculation"
          type: "boolean"
          nullable: true
        - name: "EntityVersion"
          type: "array<EntityVersion>"

    DimensionCompanyGroupDTO:
      description: "Company-dimension group assignment"
      source: "DimensionCompanyGroupService.cs"
      fields:
        - name: "DimensionCompanyGroupID"
          type: "integer"
        - name: "GroupCode"
          type: "string"
        - name: "GroupName"
          type: "string"
        - name: "DimensionID"
          type: "integer"
          description: "Associated dimension"

    DimensionGroupCompaniesDTO:
      description: "Company in dimension company group"
      fields:
        - name: "CompanyID"
          type: "integer"
        - name: "CompanyCode"
          type: "string"
        - name: "CompanyName"
          type: "string"

  # ============================================================================
  # DIMENSION HANDLERS
  # ============================================================================
  dimension_handlers:
    description: |
      Endpoints for managing dimension master data.
      Source: Sigma.Mona.WebApplication/Screens/Dimension/DimensionService.cs

    handlers:
      - name: "Dimension_GetDimensions"
        description: |
          Retrieves dimensions with filtering and pagination.
          Returns dimension codes and descriptions.
        access_right: "ScreenShow_Dimensions385"
        async: true

        request:
          _t: "Dimension_GetDimensions"
          parameters:
            - name: "DimensionID"
              type: "integer"
              required: false
              description: "Specific dimension ID"
            - name: "DimensionCode"
              type: "string"
              required: false
              description: "Specific dimension code"
            - name: "FilterDimensionCode"
              type: "string"
              required: false
              description: "Filter by code pattern"
            - name: "FilterDimensionDescription"
              type: "string"
              required: false
              description: "Filter by description pattern"
            - name: "scf_from_row"
              type: "integer"
              required: false
            - name: "scf_row_count"
              type: "integer"
              required: false
            - name: "scf_order_by"
              type: "string"
              required: false
              valid_values: ["DIMENSIONCODE", "DIMENSIONDESCRIPTION"]
            - name: "scf_include_total_row_count"
              type: "boolean"
              required: false
            - name: "scf_include_entities"
              type: "boolean"
              required: false
          example_list:
            json: |
              {
                "_t": "Dimension_GetDimensions",
                "scf_order_by": "DIMENSIONCODE ASC",
                "scf_include_total_row_count": true
              }
          example_single:
            json: |
              {
                "_t": "Dimension_GetDimensions",
                "DimensionCode": "PRODUCT",
                "scf_include_entities": true
              }

        response:
          list:
            scf_items:
              type: "array<DimensionDTO>"
            scf_total_row_count:
              type: "integer"
          single:
            scf_items:
              type: "DimensionDTO"
              description: "Full dimension with EntityVersion"

      - name: "Dimension_SaveDimension"
        description: |
          Creates or updates a dimension.
          Validates dimension code uniqueness.
        access_right: "ScreenWrite_Dimensions386"
        async: true

        request:
          _t: "Dimension_SaveDimension"
          parameters:
            - name: "Dimension"
              type: "object"
              required: true
              nested_parameters:
                - name: "DimensionID"
                  type: "integer"
                  required: false
                  description: "Null for new"
                - name: "DimensionCode"
                  type: "string"
                  required: true
                  validation: "ValidateCode (new only)"
                - name: "DimensionDescription"
                  type: "string"
                  required: true
                - name: "EntityVersion"
                  type: "array<EntityVersion>"
                  required: "if updating"
            - name: "LogScreenID"
              type: "integer"
              required: false
          example:
            json: |
              {
                "_t": "Dimension_SaveDimension",
                "Dimension": {
                  "DimensionID": null,
                  "DimensionCode": "PRODUCT",
                  "DimensionDescription": "Product Line"
                }
              }

        response:
          success:
            description: "Empty response on success"
          errors:
            - pattern: "P_CONSO_CHECK_LOCKED"
              cause: "Period is locked"

      - name: "Dimension_RemoveDimension"
        description: |
          Deletes a dimension and cleans up related records.
          Removes account-flow links and event details.
        access_right: "ScreenWrite_Dimensions386"
        async: true

        request:
          _t: "Dimension_RemoveDimension"
          parameters:
            - name: "DimensionID"
              type: "integer"
              required: true
            - name: "scf_entity_version"
              type: "array<EntityVersion>"
              required: true
            - name: "LogScreenID"
              type: "integer"
              required: false
          example:
            json: |
              {
                "_t": "Dimension_RemoveDimension",
                "DimensionID": 123,
                "scf_entity_version": [{"Name": "Dimension", "Key": "789_123", "Version": 1}]
              }

        response:
          success:
            description: "Empty response on success"
          warnings:
            - pattern: "FLOW_IN_USE_AS_RATEFLOW"
              cause: "Dimension referenced by rate flow"
          errors:
            - pattern: "CANT_DELETE_FLOW_BECAUSE_OF_DETAILS"
              cause: "Dimension has dependent data"

      - name: "Dimension_GetDimensionDetailsCodeDescription"
        description: |
          Returns dimension detail code/description pairs for autocomplete.
          Supports context filtering by DimensionID or DimensionGroupID.
        access_right: null
        async: true

        request:
          _t: "Dimension_GetDimensionDetailsCodeDescription"
          parameters:
            - name: "code"
              type: "string"
              required: false
              description: "Code pattern"
            - name: "description"
              type: "string"
              required: false
              description: "Description pattern"
            - name: "maxRows"
              type: "integer"
              required: false
            - name: "context"
              type: "string"
              required: false
              description: "DimensionID=X or DimensionGroupID=X&DimensionNumber=1|2|3"
          example:
            json: |
              {
                "_t": "Dimension_GetDimensionDetailsCodeDescription",
                "code": "PRD%",
                "context": "DimensionID=123",
                "maxRows": 20
              }

        response:
          success:
            scf_items:
              type: "array<KeyValuePair<string,string>>"
              description: "Code -> 'Code: Description' pairs with indentation"

      - name: "Dimension_GetDimensionGroups"
        description: |
          Retrieves dimension groups with optional filtering.
          Returns groups with their associated dimensions.
        access_right: "Dimension_GetDimensionGroups"
        async: true

        request:
          _t: "Dimension_GetDimensionGroups"
          parameters:
            - name: "DimensionGroupCode"
              type: "string"
              required: false
            - name: "FilterDimensionGroupCode"
              type: "string"
              required: false
            - name: "FilterDimensionGroupName"
              type: "string"
              required: false
            - name: "OutputOnlyCodes"
              type: "boolean"
              required: false
              default: false
            - name: "ConsoCode"
              type: "string"
              required: false
            - name: "scf_order_by"
              type: "string"
              required: false
              valid_values: ["DIMENSIONGROUPCODE", "DIMENSIONGROUPNAME"]
            - name: "scf_include_total_row_count"
              type: "boolean"
              required: false

        response:
          success:
            scf_items:
              type: "array"
              element_schema:
                DimensionGroupCode: "string"
                DimensionGroupName: "string"
                Active: "boolean"
                Dimension1Code: "string"
                Dimension1Name: "string"
                Dimension2Code: "string"
                Dimension2Name: "string"
                Dimension3Code: "string"
                Dimension3Name: "string"

  # ============================================================================
  # DIMENSION GROUP HANDLERS
  # ============================================================================
  dimension_group_handlers:
    description: |
      Endpoints for managing dimension groups (combinations of dimensions).
      Source: Sigma.Mona.WebApplication/Screens/Dimension/DimensionGroupService.cs

    handlers:
      - name: "DimensionGroup_FillDimensionGroup"
        description: |
          Returns dimension groups for dropdown population.
          Supports filtering by active status.
        access_right: "DimensionGroup_FillDimensionGroup"
        async: true

        request:
          _t: "DimensionGroup_FillDimensionGroup"
          parameters:
            - name: "addEmptyItemFirst"
              type: "boolean"
              required: false
              default: false
            - name: "excludeMultiPeriod"
              type: "boolean"
              required: false
              default: false
            - name: "ConsoID"
              type: "integer"
              required: false
            - name: "FilterActive"
              type: "boolean"
              required: false

        response:
          success:
            scf_items:
              type: "array<DimensionGroupInfoDTO>"
              element_schema:
                DimensionGroupCode: "string"
                DimensionGroupName: "string"

      - name: "DimensionGroup_GetDimensionGroups"
        description: |
          Retrieves dimension groups with filtering and pagination.
          Single record includes selected/available accounts.
        access_right: "DimensionGroup_GetDimensionGroups"
        async: true

        request:
          _t: "DimensionGroup_GetDimensionGroups"
          parameters:
            - name: "DimensionGroupID"
              type: "integer"
              required: false
            - name: "DimensionGroupCode"
              type: "string"
              required: false
            - name: "FilterDimensionGroupCode"
              type: "string"
              required: false
            - name: "FilterDimensionGroupName"
              type: "string"
              required: false
            - name: "FilterActive"
              type: "boolean"
              required: false
            - name: "scf_include_entities"
              type: "boolean"
              required: false
            - name: "scf_from_row"
              type: "integer"
              required: false
            - name: "scf_row_count"
              type: "integer"
              required: false
            - name: "scf_order_by"
              type: "string"
              required: false
              valid_values: ["DIMENSIONGROUPCODE", "DIMENSIONGROUPNAME"]
            - name: "scf_include_total_row_count"
              type: "boolean"
              required: false
          example_list:
            json: |
              {
                "_t": "DimensionGroup_GetDimensionGroups",
                "FilterActive": true,
                "scf_order_by": "DIMENSIONGROUPCODE ASC",
                "scf_include_total_row_count": true
              }
          example_single:
            json: |
              {
                "_t": "DimensionGroup_GetDimensionGroups",
                "DimensionGroupID": 123,
                "scf_include_entities": true
              }

        response:
          list:
            scf_items:
              type: "array<DimensionGroupDTO>"
          single:
            scf_items:
              type: "DimensionGroupDTO"
              description: "Full group with SelectedAccounts and AvailableAccounts"

      - name: "DimensionGroup_SaveDimensionGroup"
        description: |
          Creates or updates a dimension group.
          Also supports moving accounts between selected/available.
        access_right: "DimensionGroup_ManageDimensionGroups"
        async: true

        request:
          _t: "DimensionGroup_SaveDimensionGroup"
          parameters:
            - name: "DimensionGroup"
              type: "object"
              required: true
              nested_parameters:
                - name: "DimensionGroupID"
                  type: "integer"
                  required: false
                  description: "Null for new"
                - name: "DimensionGroupCode"
                  type: "string"
                  required: true
                  validation: "Max 25 characters"
                - name: "DimensionGroupName"
                  type: "string"
                  required: true
                - name: "Active"
                  type: "boolean"
                  required: false
                  default: false
                - name: "Dimension1ID"
                  type: "integer"
                  required: true
                - name: "Dimension2ID"
                  type: "integer"
                  required: false
                - name: "Dimension3ID"
                  type: "integer"
                  required: false
                - name: "ToSelected"
                  type: "array<integer>"
                  required: false
                  description: "AccountIDs to move to selected"
                - name: "ToAvailable"
                  type: "array<integer>"
                  required: false
                  description: "AccountIDs to move to available"
                - name: "EntityVersion"
                  type: "array<EntityVersion>"
                  required: "if updating"
            - name: "LogScreenID"
              type: "integer"
              required: false
          example_new:
            json: |
              {
                "_t": "DimensionGroup_SaveDimensionGroup",
                "DimensionGroup": {
                  "DimensionGroupID": null,
                  "DimensionGroupCode": "PRODREGION",
                  "DimensionGroupName": "Product by Region",
                  "Active": true,
                  "Dimension1ID": 1,
                  "Dimension2ID": 2
                }
              }
          example_move_accounts:
            json: |
              {
                "_t": "DimensionGroup_SaveDimensionGroup",
                "DimensionGroup": {
                  "DimensionGroupID": 123,
                  "ToSelected": [101, 102, 103],
                  "EntityVersion": [{"Name": "DimensionGroup", "Key": "789_123", "Version": 1}]
                }
              }

        response:
          success:
            description: "Empty response on success"
          errors:
            - pattern: "DimensionGroupCodeInvalidLen"
              cause: "Code exceeds 25 characters"
            - pattern: "DimensionGroupDimension1Required"
              cause: "First dimension is required"

      - name: "DimensionGroup_RemoveDimensionGroup"
        description: |
          Deletes a dimension group and cleans up related records.
          Validates group is not used in data.
        access_right: "DimensionGroup_ManageDimensionGroups"
        async: true

        request:
          _t: "DimensionGroup_RemoveDimensionGroup"
          parameters:
            - name: "DimensionGroupID"
              type: "integer"
              required: true
            - name: "scf_entity_version"
              type: "array<EntityVersion>"
              required: true
            - name: "LogScreenID"
              type: "integer"
              required: false

        response:
          success:
            description: "Empty response on success"
          errors:
            - pattern: "DimensionGroup_Remove_UsedInLocalPartner"
              cause: "Used in local partner data"
            - pattern: "DimensionGroup_Remove_UsedInConsolidatedAmount"
              cause: "Used in consolidated amounts"
            - pattern: "FK_TS019S5_TS050G4"
              cause: "Used in validation rule details"

  # ============================================================================
  # DIMENSION TREE HANDLERS
  # ============================================================================
  dimension_tree_handlers:
    description: |
      Endpoints for managing hierarchical dimension structures.
      Source: Sigma.Mona.WebApplication/Screens/Dimension/DimensionTreeService.cs

    handlers:
      - name: "DimensionTree_GetDimensionTree"
        description: |
          Retrieves the full dimension tree for a dimension.
          Returns hierarchical TreeNodeItem structure.
        access_right: "DimensionTree_GetDimensionTree"
        async: true

        request:
          _t: "DimensionTree_GetDimensionTree"
          parameters:
            - name: "DimensionID"
              type: "integer"
              required: true
          example:
            json: |
              {
                "_t": "DimensionTree_GetDimensionTree",
                "DimensionID": 123
              }

        response:
          success:
            scf_items:
              type: "object"
              schema:
                DimensionTree:
                  type: "array<TreeNodeItem>"
                  description: "Hierarchical tree structure"

      - name: "DimensionTree_GetDimensionDetails"
        description: |
          Retrieves a single dimension detail by ID.
          Returns code, name, and parent information.
        access_right: "DimensionTree_GetDimensionTree"
        async: true

        request:
          _t: "DimensionTree_GetDimensionDetails"
          parameters:
            - name: "DimensionID"
              type: "integer"
              required: true
            - name: "DimensionTreeID"
              type: "integer"
              required: true
              description: "DimensionDetailID"
            - name: "scf_include_entities"
              type: "boolean"
              required: false
          example:
            json: |
              {
                "_t": "DimensionTree_GetDimensionDetails",
                "DimensionID": 123,
                "DimensionTreeID": 456,
                "scf_include_entities": true
              }

        response:
          success:
            scf_items:
              type: "object"
              schema:
                DimensionDetailID: "integer"
                Code: "string"
                Name: "string"
                ParentDimension: "string"
                EntityVersion: "array<EntityVersion>"

      - name: "DimensionTree_SaveDimensionDetail"
        description: |
          Creates or updates a dimension detail node.
          Recalculates tree order numbers after save.
        access_right: "DimensionTree_ManageDimensionTree"
        async: true

        request:
          _t: "DimensionTree_SaveDimensionDetail"
          parameters:
            - name: "ScreenID"
              type: "integer"
              required: true
            - name: "DimensionID"
              type: "integer"
              required: true
            - name: "DimensionDetailID"
              type: "integer"
              required: false
              description: "Null for new"
            - name: "Code"
              type: "string"
              required: true
              validation: "ValidateCode for new records"
            - name: "Name"
              type: "string"
              required: true
            - name: "ParentDimension"
              type: "string"
              required: true
              description: "Parent dimension detail code"
            - name: "scf_entity_version"
              type: "array<EntityVersion>"
              required: "if updating"
          example:
            json: |
              {
                "_t": "DimensionTree_SaveDimensionDetail",
                "ScreenID": 100,
                "DimensionID": 123,
                "DimensionDetailID": null,
                "Code": "ELECTRONICS",
                "Name": "Electronics Products",
                "ParentDimension": "PRODUCTS"
              }

        response:
          success:
            scf_items:
              type: "object"
              schema:
                DimensionDetailID: "integer"
          errors:
            - pattern: "P_CONSO_CHECK_LOCKED"
              cause: "Period is locked"
            - pattern: "DIMENSIONDETAIL_NOPARENT_SPECIFIED"
              cause: "Parent not found"
            - pattern: "DIMENSIONTREE_NO_CIRCULAR_REFERENCE"
              cause: "Circular reference detected"

      - name: "DimensionTree_RemoveDimensionDetail"
        description: |
          Deletes a dimension detail node and all children.
          Cleans up event details, elimination details, and validation rules.
        access_right: "DimensionTree_ManageDimensionTree"
        async: true

        request:
          _t: "DimensionTree_RemoveDimensionDetail"
          parameters:
            - name: "ScreenID"
              type: "integer"
              required: true
            - name: "DimensionID"
              type: "integer"
              required: true
            - name: "DimensionDetailID"
              type: "integer"
              required: true
          example:
            json: |
              {
                "_t": "DimensionTree_RemoveDimensionDetail",
                "ScreenID": 100,
                "DimensionID": 123,
                "DimensionDetailID": 456
              }

        response:
          success:
            description: "Empty response on success"
          errors:
            - pattern: "CANT_DELETE_DIMENSIONDETAIL_BECAUSE_OF_DETAILS"
              cause: "Dimension detail has dependent data"

      - name: "DimensionTree_GetDimTreeNode"
        description: |
          Retrieves dimension tree nodes with lazy loading.
          Supports filtering by code and description.
        access_right: "DimensionTree_GetDimensionTree"
        async: true

        request:
          _t: "DimensionTree_GetDimTreeNode"
          parameters:
            - name: "ID"
              type: "integer"
              required: false
              description: "Parent DimensionDetailID (null for root)"
            - name: "ConsoID"
              type: "integer"
              required: false
            - name: "FilterCode"
              type: "string"
              required: false
            - name: "FilterDescription"
              type: "string"
              required: false
          example_root:
            json: |
              {
                "_t": "DimensionTree_GetDimTreeNode",
                "ID": null
              }
          example_children:
            json: |
              {
                "_t": "DimensionTree_GetDimTreeNode",
                "ID": 123
              }

        response:
          root:
            scf_items:
              type: "array<DimTreeNode>"
          children:
            Children:
              type: "array<DimTreeNode>"

  # ============================================================================
  # DIMENSION DATA ENTRY HANDLERS
  # ============================================================================
  dimension_data_entry_handlers:
    description: |
      Endpoints for dimension-level data entry (matrix view).
      Source: Sigma.Mona.WebApplication/Screens/DimensionDataEntry/DimensionDataEntryService.cs

    handlers:
      - name: "DimensionDataEntry_GetDimensionGroupList"
        description: |
          Retrieves dimension groups available for an account.
          Used to populate dimension group dropdown in data entry.
        access_right: "DimensionDataEntry_GetDimensionDataEntry"
        async: true

        request:
          _t: "DimensionDataEntry_GetDimensionGroupList"
          parameters:
            - name: "AccountCode"
              type: "string"
              required: false
              description: "Account to get groups for"
            - name: "JournalCode"
              type: "string"
              required: false
              description: "Journal code (for group adjustments)"
            - name: "JournalEntry"
              type: "long"
              required: false
            - name: "JournalSequence"
              type: "integer"
              required: false
          example:
            json: |
              {
                "_t": "DimensionDataEntry_GetDimensionGroupList",
                "AccountCode": "6000"
              }

        response:
          success:
            AccountCode:
              type: "string"
            AccountDescription:
              type: "string"
            scf_items:
              type: "array"
              element_schema:
                ID: "string"
                Name: "string"

      - name: "DimensionDataEntry_GetDimensionDataEntry"
        description: |
          Retrieves dimension data entry matrix for an account.
          Returns 3D matrix (X, Y, Z axes) with amounts.
        access_right: "DimensionDataEntry_GetDimensionDataEntry"
        async: true

        request:
          _t: "DimensionDataEntry_GetDimensionDataEntry"
          parameters:
            - name: "DisplayMode"
              type: "short"
              required: true
              description: "1=Local, 2=LocalInterco, 3=GroupAdjustments"
              enum_ref: "DisplayModes"
            - name: "CompanyCode"
              type: "string"
              required: false
            - name: "AccountCode"
              type: "string"
              required: false
            - name: "PartnerCode"
              type: "string"
              required: false
              description: "For LocalInterco mode"
            - name: "TransactionCurrCode"
              type: "string"
              required: false
            - name: "JournalCode"
              type: "string"
              required: false
              description: "For GroupAdjustments mode"
            - name: "JournalEntry"
              type: "long"
              required: false
            - name: "JournalSequence"
              type: "integer"
              required: false
            - name: "DimensionGroupID"
              type: "integer"
              required: false
            - name: "IsUsingReferencePeriod"
              type: "boolean"
              required: false
              default: false
          example_local:
            json: |
              {
                "_t": "DimensionDataEntry_GetDimensionDataEntry",
                "DisplayMode": 1,
                "CompanyCode": "ACME",
                "AccountCode": "6000",
                "DimensionGroupID": 123
              }
          example_group:
            json: |
              {
                "_t": "DimensionDataEntry_GetDimensionDataEntry",
                "DisplayMode": 3,
                "JournalCode": "M01",
                "JournalEntry": 1001,
                "JournalSequence": 1,
                "DimensionGroupID": 123
              }

        response:
          success:
            scf_items:
              type: "DimensionDataEntryResult"

      - name: "DimensionDataEntry_SaveDimensionDataEntry"
        description: |
          Saves dimension data entry changes.
          Accepts array of changed matrix cells.
        access_right: "DimensionDataEntry_ManageDimensionDataEntry"
        async: true

        request:
          _t: "DimensionDataEntry_SaveDimensionDataEntry"
          parameters:
            - name: "screenID"
              type: "integer"
              required: false
            - name: "DisplayMode"
              type: "short"
              required: true
              enum_ref: "DisplayModes"
            - name: "CompanyCode"
              type: "string"
              required: false
            - name: "AccountCode"
              type: "string"
              required: false
            - name: "PartnerCode"
              type: "string"
              required: false
            - name: "TransactionCurrCode"
              type: "string"
              required: false
            - name: "JournalCode"
              type: "string"
              required: false
            - name: "JournalEntry"
              type: "long"
              required: false
            - name: "JournalSequence"
              type: "integer"
              required: false
            - name: "DimensionGroupID"
              type: "integer"
              required: false
            - name: "UnitsOf"
              type: "byte"
              required: true
            - name: "IncludeSign"
              type: "short"
              required: true
            - name: "ChangedItems"
              type: "array"
              required: true
              description: "Array of changed cells"
              element_schema:
                X: "integer (Dimension2DetailID or -1)"
                Y: "integer (Dimension1DetailID)"
                Z: "integer (Dimension3DetailID or -1)"
                Value: "decimal"
            - name: "scf_entity_version"
              type: "array<EntityVersion>"
              required: true
          example:
            json: |
              {
                "_t": "DimensionDataEntry_SaveDimensionDataEntry",
                "DisplayMode": 1,
                "CompanyCode": "ACME",
                "AccountCode": "6000",
                "DimensionGroupID": 123,
                "UnitsOf": 0,
                "IncludeSign": 1,
                "ChangedItems": [
                  {"X": 10, "Y": 20, "Z": -1, "Value": 1000.00},
                  {"X": 10, "Y": 21, "Z": -1, "Value": 2000.00}
                ],
                "scf_entity_version": [{"Name": "DimensionDataEntryLocal", "Key": "789_ACME-6000-123", "Version": 1}]
              }

        response:
          success:
            description: "Empty response on success"

      - name: "DimensionDataEntry_GetDimensionDataEntryModel"
        description: |
          Returns model data for SPA mode initialization.
          Resolves IDs to codes and prepares dropdown options.
        access_right: "DimensionDataEntry_GetDimensionDataEntry"
        async: true

        request:
          _t: "DimensionDataEntry_GetDimensionDataEntryModel"
          parameters:
            - name: "ScreenID"
              type: "integer"
              required: true
            - name: "Entry"
              type: "long"
              required: false
            - name: "Sequence"
              type: "integer"
              required: false
            - name: "Partner"
              type: "string"
              required: false
            - name: "CompanyID"
              type: "integer"
              required: false
            - name: "Company"
              type: "string"
              required: false
            - name: "AccountID"
              type: "integer"
              required: false
            - name: "Account"
              type: "string"
              required: false
            - name: "TransCurr"
              type: "string"
              required: false
            - name: "Journal"
              type: "string"
              required: false
            - name: "Period"
              type: "string"
              required: false
              default: "C"
              description: "C=Current, R=Reference"
            - name: "DimensionGroup"
              type: "string"
              required: false

        response:
          success:
            scf_items:
              type: "object"
              schema:
                canModify: "boolean"
                screenID: "integer"
                displayMode: "string"
                company: "string"
                account: "string"
                partner: "string"
                transCurr: "string"
                journal: "string"
                entry: "string"
                sequence: "integer"
                dimensionGroupID: "integer"
                DDLDropdownOptions: "array"
                Period: "string"

  # ============================================================================
  # DIMENSION COMPANY GROUP HANDLERS
  # ============================================================================
  dimension_company_group_handlers:
    description: |
      Endpoints for managing company-dimension group assignments.
      Source: Sigma.Mona.WebApplication/Screens/DimensionCompanyGroup/DimensionCompanyGroupService.cs
      Note: Uses LINQ-to-SQL (not yet migrated to EF)

    handlers:
      - name: "Dimension_GetDimensionCompanyGroups"
        description: |
          Retrieves all dimension company groups.
          Also returns list of available dimensions.
        access_right: "DimensionCompanyGroup_GetDimensionCompanyGroup"
        async: false

        request:
          _t: "Dimension_GetDimensionCompanyGroups"
          parameters: []
          example:
            json: |
              {
                "_t": "Dimension_GetDimensionCompanyGroups"
              }

        response:
          success:
            scf_items:
              type: "array"
              element_schema:
                DimensionCompanyGroupID: "integer"
                GroupName: "string"
                GroupCode: "string"
            DimensionsList:
              type: "array"
              element_schema:
                ID: "integer"
                Name: "string"

      - name: "Dimension_GetDimensionCompanyGroupByID"
        description: |
          Retrieves a single dimension company group.
        access_right: "DimensionCompanyGroup_GetDimensionCompanyGroup"
        async: false

        request:
          _t: "Dimension_GetDimensionCompanyGroupByID"
          parameters:
            - name: "ItemID"
              type: "integer"
              required: false
            - name: "GroupCode"
              type: "string"
              required: "if ItemID not provided"
          example:
            json: |
              {
                "_t": "Dimension_GetDimensionCompanyGroupByID",
                "ItemID": 123
              }

        response:
          success:
            scf_items:
              type: "object"
              schema:
                DimensionCompanyGroupID: "integer"
                GroupCode: "string"
                GroupName: "string"
                DimensionID: "integer"
                EntityVersion: "EntityVersion"

      - name: "Dimension_SaveDimensionCompanyGroup"
        description: |
          Creates or updates a dimension company group.
        access_right: "DimensionCompanyGroup_ManageDimensionCompanyGroup"
        async: false

        request:
          _t: "Dimension_SaveDimensionCompanyGroup"
          parameters:
            - name: "ItemID"
              type: "integer"
              required: false
              description: "Null for new"
            - name: "GroupCode"
              type: "string"
              required: true
            - name: "GroupName"
              type: "string"
              required: true
            - name: "DimensionID"
              type: "integer"
              required: true
            - name: "scf_entity_version"
              type: "array<EntityVersion>"
              required: "if updating"
            - name: "LogScreenID"
              type: "integer"
              required: false
          example:
            json: |
              {
                "_t": "Dimension_SaveDimensionCompanyGroup",
                "ItemID": null,
                "GroupCode": "REGGRP",
                "GroupName": "Regional Grouping",
                "DimensionID": 123
              }

        response:
          success:
            description: "Empty response on success"

      - name: "Dimension_RemoveDimensionCompanyGroup"
        description: |
          Deletes a dimension company group.
        access_right: "DimensionCompanyGroup_ManageDimensionCompanyGroup"
        async: false

        request:
          _t: "Dimension_RemoveDimensionCompanyGroup"
          parameters:
            - name: "ItemID"
              type: "integer"
              required: true
            - name: "scf_entity_version"
              type: "array<EntityVersion>"
              required: true
            - name: "LogScreenID"
              type: "integer"
              required: false

        response:
          success:
            description: "Empty response on success"

      - name: "Dimension_GetDimensionGroupCompanies"
        description: |
          Retrieves companies for a dimension company group.
          Supports selected/available filtering.
        access_right: "DimensionCompanyGroup_GetDimensionCompanyGroup"
        async: false

        request:
          _t: "Dimension_GetDimensionGroupCompanies"
          parameters:
            - name: "ItemID"
              type: "integer"
              required: true
              description: "DimensionCompanyGroupID"
            - name: "Type"
              type: "char"
              required: true
              description: "A=Available, S=Selected"
            - name: "filterDimensionCompanyGroupCode"
              type: "string"
              required: false
            - name: "filterDimensionCompanyGroupName"
              type: "string"
              required: false
            - name: "scf_order_by"
              type: "string"
              required: false
              valid_values: ["CODE", "NAME"]
          example:
            json: |
              {
                "_t": "Dimension_GetDimensionGroupCompanies",
                "ItemID": 123,
                "Type": "S"
              }

        response:
          success:
            scf_items:
              type: "array<DimensionGroupCompaniesDTO>"

      - name: "Dimension_UpdateDimensionGroupCompanies"
        description: |
          Adds or removes companies from a dimension company group.
        access_right: "DimensionCompanyGroup_ManageDimensionCompanyGroup"
        async: false

        request:
          _t: "Dimension_UpdateDimensionGroupCompanies"
          parameters:
            - name: "ItemID"
              type: "integer"
              required: true
            - name: "GroupCode"
              type: "string"
              required: true
            - name: "Type"
              type: "char"
              required: true
              description: "Current state: A=Available (moving to Selected), S=Selected (moving to Available)"
            - name: "CompanyIDList"
              type: "array<integer>"
              required: true
              description: "Company IDs to move"
            - name: "scf_entity_version"
              type: "array<EntityVersion>"
              required: true
            - name: "LogScreenID"
              type: "integer"
              required: false
          example:
            json: |
              {
                "_t": "Dimension_UpdateDimensionGroupCompanies",
                "ItemID": 123,
                "GroupCode": "REGGRP",
                "Type": "A",
                "CompanyIDList": [1, 2, 3],
                "scf_entity_version": [{"Name": "DimensionCompanyGroup", "Key": "789_123", "Version": 1}]
              }

        response:
          success:
            description: "Empty response on success"

      - name: "Dimension_GetDimensionCompanyGroup_DIM"
        description: |
          Retrieves dimension detail tree for a company group.
          Shows which dimension details are checked.
        access_right: "DimensionCompanyGroup_GetDimensionCompanyGroup"
        async: false

        request:
          _t: "Dimension_GetDimensionCompanyGroup_DIM"
          parameters:
            - name: "ItemID"
              type: "integer"
              required: true
          example:
            json: |
              {
                "_t": "Dimension_GetDimensionCompanyGroup_DIM",
                "ItemID": 123
              }

        response:
          success:
            scf_items:
              type: "array<TreeNodeItem>"
              description: "Tree with Selected property for checked nodes"

      - name: "Dimension_UpdateDimensionCompanyGroup_DIM"
        description: |
          Updates dimension detail selections for a company group.
        access_right: "DimensionCompanyGroup_ManageDimensionCompanyGroup"
        async: false

        request:
          _t: "Dimension_UpdateDimensionCompanyGroup_DIM"
          parameters:
            - name: "ItemID"
              type: "integer"
              required: true
            - name: "GroupCode"
              type: "string"
              required: true
            - name: "SelectedNodes"
              type: "array<integer>"
              required: true
              description: "DimensionDetailIDs to select"
            - name: "scf_entity_version"
              type: "array<EntityVersion>"
              required: true
            - name: "LogScreenID"
              type: "integer"
              required: false
          example:
            json: |
              {
                "_t": "Dimension_UpdateDimensionCompanyGroup_DIM",
                "ItemID": 123,
                "GroupCode": "REGGRP",
                "SelectedNodes": [10, 11, 12],
                "scf_entity_version": [{"Name": "DimensionCompanyGroup", "Key": "789_123", "Version": 1}]
              }

        response:
          success:
            description: "Empty response on success"

  # ============================================================================
  # WORKFLOW ORCHESTRATION
  # ============================================================================
  orchestration:
    dimension_setup_workflow:
      name: "Dimension Setup Workflow"
      description: "Complete workflow for setting up dimensions"
      steps:
        - step: 1
          name: "Create Dimension"
          handler: "Dimension_SaveDimension"
          purpose: "Create new analytical dimension"

        - step: 2
          name: "Build Tree Structure"
          handler: "DimensionTree_SaveDimensionDetail"
          repeat: true
          purpose: "Add hierarchy nodes to dimension"

        - step: 3
          name: "Create Dimension Group"
          handler: "DimensionGroup_SaveDimensionGroup"
          purpose: "Create group combining dimensions"

        - step: 4
          name: "Assign Accounts"
          handler: "DimensionGroup_SaveDimensionGroup"
          parameters:
            ToSelected: "[accountIDs]"
          purpose: "Link accounts to dimension group"

        - step: 5
          name: "Verify Structure"
          handler: "DimensionTree_GetDimensionTree"
          purpose: "Review dimension hierarchy"

    dimension_data_entry_workflow:
      name: "Dimension Data Entry Workflow"
      description: "Enter dimension-level amounts"
      steps:
        - step: 1
          name: "Get Dimension Groups"
          handler: "DimensionDataEntry_GetDimensionGroupList"
          purpose: "Find available dimension groups for account"

        - step: 2
          name: "Load Data Entry Matrix"
          handler: "DimensionDataEntry_GetDimensionDataEntry"
          purpose: "Get current dimension amounts"

        - step: 3
          name: "Enter Amounts"
          description: "User enters amounts in matrix cells"
          client_side: true

        - step: 4
          name: "Save Changes"
          handler: "DimensionDataEntry_SaveDimensionDataEntry"
          purpose: "Persist dimension amounts"

    company_dimension_assignment_workflow:
      name: "Company-Dimension Assignment Workflow"
      description: "Assign companies to dimension details"
      steps:
        - step: 1
          name: "Create Company Group"
          handler: "Dimension_SaveDimensionCompanyGroup"
          purpose: "Create dimension company group"

        - step: 2
          name: "Get Available Companies"
          handler: "Dimension_GetDimensionGroupCompanies"
          parameters:
            Type: "A"
          purpose: "List companies to add"

        - step: 3
          name: "Assign Companies"
          handler: "Dimension_UpdateDimensionGroupCompanies"
          purpose: "Add companies to group"

        - step: 4
          name: "Configure Dimension Details"
          handler: "Dimension_UpdateDimensionCompanyGroup_DIM"
          purpose: "Select specific dimension details for group"

  # ============================================================================
  # METADATA
  # ============================================================================
  metadata:
    created: "2024-12-02"
    source_files:
      - "Sigma.Mona.WebApplication/Screens/Dimension/DimensionService.cs"
      - "Sigma.Mona.WebApplication/Screens/Dimension/DimensionGroupService.cs"
      - "Sigma.Mona.WebApplication/Screens/Dimension/DimensionTreeService.cs"
      - "Sigma.Mona.WebApplication/Screens/DimensionDataEntry/DimensionDataEntryService.cs"
      - "Sigma.Mona.WebApplication/Screens/DimensionCompanyGroup/DimensionCompanyGroupService.cs"
    handler_count: 26
    purpose: |
      Enable AI agents to manage dimensions and dimension groups including:
      - Creating and maintaining analytical dimensions
      - Building hierarchical dimension trees
      - Creating dimension groups combining multiple dimensions
      - Assigning accounts to dimension groups
      - Entering dimension-level amounts in matrix view
      - Linking companies to dimension details

      Dimensions are essential for:
      - Segment reporting and analysis
      - Multi-dimensional consolidation
      - Product/region/department breakdowns
      - Management reporting flexibility
